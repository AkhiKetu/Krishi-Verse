<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Supplier Dashboard | Krishi-Verse</title>
  <link rel="stylesheet" href="supplierDashboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2 class="logo">Krishi-Verse</h2>
      <div class="user">
        <img src="supplier.png" alt="User" />
        <p>Jamal Uddin<br><span>Supplier</span></p>
      </div>
      <nav>
        <ul>
          <li><a href="#" data-page="supplier-home"><i class="fas fa-home"></i> Home</a></li>
          <li><a href="#" data-page="supplier-crop"><i class="fas fa-seedling"></i> Crops</a></li>
          <li><a href="#" data-page="supplier-inventory"><i class="fas fa-warehouse"></i> Inventory</a></li>
          <li><a href="#" data-page="supplier-transport"><i class="fas fa-truck"></i> Transport</a></li>
          <li><a href="#" data-page="supplier-market"><i class="fas fa-dollar-sign"></i> Market Prices</a></li>
          <li><a href="#" data-page="weather"><i class="fas fa-cloud-sun"></i> Weather</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="main">
      <header>
      
        <div class="header-right">
          <a href="#" class="notification-btn">Notification</a>
          <a href="#" class="message-btn">Messages</a>
          <div class="profile-dropdown">
            <a href="#" class="profile-btn" onclick="toggleDropdown(event)">Profile <i class="fas fa-caret-down"></i></a>
            <div id="dropdown-menu" class="dropdown-content">
              <a href="#">Edit Profile</a>
              <a href="#">Settings</a>
            </div>
          </div>
          <a href="#" onclick="logout()" class="logout-btn">Logout</a>
        </div>
      </header>

      <section class="content">
        <!-- This will load crop.html, etc. -->
      </section>
    </div>
  </div>

  <!-- Crop Modal (kept globally for dynamic content support) -->
  <div id="cropModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 id="modalTitle">Add Crop</h3>
      <form id="cropForm">
        <input type="text" id="cropName" placeholder="Crop Name" required />
        <input type="text" id="cropType" placeholder="Crop Type" required />
        <input type="number" id="cropQuantity" placeholder="Quantity (kg)" required />
        <input type="text" id="cropStatus" placeholder="Status (e.g. Growing)" required />
        <select id="cropSeason" required>
          <option value="" disabled selected>Select Season</option>
          <option value="summer">Summer</option>
          <option value="winter">Winter</option>
          <option value="monsoon">Monsoon</option>
          <option value="full-year">Full Year</option>
        </select>
        <input type="date" id="cropDate" required />
        <div class="modal-actions">
          <button type="submit">Save</button>
          <button type="button" onclick="closeCropModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

<script>
  if (localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "login.html";
  }

  function logout() {
    localStorage.removeItem("loggedIn");
    window.location.href = "index.html";
  }

  function toggleDropdown(e) {
    e.preventDefault();
    document.getElementById("dropdown-menu").classList.toggle("show");
  }

  window.addEventListener("click", function (e) {
    if (!e.target.closest(".profile-dropdown")) {
      document.getElementById("dropdown-menu").classList.remove("show");
    }
  });

  const contentArea = document.querySelector('.content');

  document.querySelectorAll('nav a').forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault();
      loadContent(this.getAttribute('data-page'));
    });
  });

  function loadContent(page) {
    fetch(`${page}.html`)
      .then(res => res.text())
      .then(html => {
        contentArea.innerHTML = html;

        if (page === 'supplier-crop') {
          setupCropPage();
        }
      })
      .catch(err => contentArea.innerHTML = `<p>Error loading ${page}.</p>`);
  }

  // Modal and edit/delete state
  const cropModal = document.getElementById("cropModal");
  const cropForm = document.getElementById("cropForm");
  let editingRow = null;

  function openCropModal() {
    editingRow = null;
    cropForm.reset();
    document.getElementById("modalTitle").textContent = "Add Crop";
    cropModal.style.display = "flex";
  }

  function closeCropModal() {
    cropModal.style.display = "none";
  }

  function setupCropPage() {
    const cropTableBody = document.getElementById("cropTableBody");
    const addCropBtn = document.getElementById("addCropBtn");
    const seasonFilter = document.getElementById("seasonFilter");

    if (!addCropBtn || !cropForm || !cropTableBody || !seasonFilter) {
      console.warn("Required elements not found in crop page.");
      return;
    }

    addCropBtn.onclick = openCropModal;

    cropForm.onsubmit = function (e) {
      e.preventDefault();

      const name = document.getElementById("cropName").value;
      const type = document.getElementById("cropType").value;
      const qty = document.getElementById("cropQuantity").value;
      const status = document.getElementById("cropStatus").value;
      const date = document.getElementById("cropDate").value;
      // For filtering, we'll add season info from filter or default 'All'
      const season = seasonFilter.value || "All";

      const rowHTML = `
        <td>${name}</td>
        <td>${type}</td>
        <td>${qty}</td>
        <td>${status}</td>
        <td>${date}</td>
        <td>${season}</td>
        <td>
          <button onclick="editCrop(this)">Edit</button>
          <button onclick="deleteCrop(this)">Delete</button>
        </td>
      `;

      if (editingRow) {
        editingRow.innerHTML = rowHTML;
        editingRow.setAttribute("data-season", season);
      } else {
        const row = document.createElement("tr");
        row.setAttribute("data-season", season);
        row.innerHTML = rowHTML;
        cropTableBody.appendChild(row);
      }

      closeCropModal();
      filterTable(); // Refresh filter to hide/show rows properly
    };

    // Filtering function
    function filterTable() {
      const selected = seasonFilter.value;
      Array.from(cropTableBody.rows).forEach(row => {
        const season = row.getAttribute("data-season");
        row.style.display = (selected === "All" || season === selected) ? "" : "none";
      });
    }

    // Run filter on change
    seasonFilter.addEventListener("change", filterTable);

    // Initial filter to set correct display after page load
    filterTable();
  }

  function editCrop(button) {
    const row = button.closest("tr");
    editingRow = row;
    document.getElementById("modalTitle").textContent = "Edit Crop";
    document.getElementById("cropName").value = row.cells[0].textContent;
    document.getElementById("cropType").value = row.cells[1].textContent;
    document.getElementById("cropQuantity").value = row.cells[2].textContent;
    document.getElementById("cropStatus").value = row.cells[3].textContent;
    document.getElementById("cropDate").value = row.cells[4].textContent;
    // Set the season filter in modal (optional, if you add a season input in modal)
    cropModal.style.display = "flex";
  }

  function deleteCrop(button) {
    if (confirm("Are you sure you want to delete this crop?")) {
      const row = button.closest("tr");
      row.remove();
    }
  }

  window.addEventListener("click", function (e) {
    if (e.target === cropModal) {
      closeCropModal();
    }
  });

  window.addEventListener('DOMContentLoaded', () => loadContent('supplier-home'));
</script>


</body>
</html>
